# 15장: 파일 시스템의 내부 작동 원리

## 1. 파일 시스템이란?

- 컴퓨터의 하드 디스크(HDD), SSD 같은 보조기억장치에는 수많은 파일이 저장됨
- **파일 시스템**: 이 파일들을 효율적으로 관리하기 위한 **규칙과 구조**를 의미  
=> 파일의 이름을 지정하고, 디스크의 어느 위치에 저장하며, 어떻게 찾을지에 대한 체계적인 방법을 제공

- **디렉터리 (폴더)**: 파일 시스템은 디렉터리를 이용해 파일들을 주제나 목적에 맞게 그룹화  
=> 나무처럼 가지를 치는 계층 구조를 이루어 파일들을 체계적으로 정리할 수 있게 도움

- **다양한 파일 시스템**: 운영체제나 장치의 특성에 따라 여러 종류의 파일 시스템이 존재
    - **디스크 파일 시스템**: Windows의 `NTFS`, `FAT32`, macOS의 `APFS`, Linux의 `ext4`처럼 하드 디스크나 SSD에 직접 설치되어 파일을 영구적으로 관리
    - **네트워크 파일 시스템**: `NFS`, `SMB` 등이 있으며, 네트워크로 연결된 다른 컴퓨터의 파일을 내 컴퓨터에 있는 것처럼 접근하게 함
    - **특수 목적 파일 시스템**
        - `procfs`: 실행 중인 프로세스 정보를 파일처럼 보여줌
        - `tmpfs`: 메모리를 저장소로 사용해 속도가 매우 빠르지만, 재부팅 시 데이터가 사라짐

## 2. 파일 시스템 마운트 (Mount)

**마운트**: 새로운 저장 장치(USB, 외장 하드 등)나 다른 파일 시스템을 컴퓨터가 인식하고 사용할 수 있도록 **기존 파일 시스템의 특정 위치에 연결**하는 과정

- **UNIX/Linux 방식**
    - 루트 디렉터리(`/`) 아래의 특정 디렉터리(예: `/mnt/usb`)를 **마운트 지점(Mount Point)**으로 삼아 연결
    - 새로운 저장 장치의 파일들이 해당 디렉터리 안에 있는 것처럼 보임
- **Windows 방식**
    - `C:`, `D:`처럼 별도의 드라이브 문자를 할당하는 것이 전통적인 방식
    - 최신 Windows: UNIX처럼 특정 폴더에 다른 드라이브를 연결하는 기능도 지원

운영체제는 마운트 요청을 받으면, 해당 장치에 어떤 종류의 파일 시스템이 있는지 확인하고 디렉터리 구조에 연결 정보를 기록함

## 3. 디스크 파티션

**파티셔닝**: 하나의 물리적 디스크를 논리적으로 여러 개의 구역으로 나누는 것
### 장점
- 운영체제 영역과 사용자 데이터 영역을 분리하여 안정성 향상
- 하나의 디스크에 여러 운영체제를 설치 가능

### 상태
- **cooked 파티션**
    - `NTFS`, `ext4` 등 파일 시스템이 설치되어 바로 파일을 저장할 수 있는 상태
- **raw 파티션**
    - 파일 시스템이 없는 순수한 공간
    - 주로 데이터베이스 시스템처럼 파일 시스템을 거치지 않고, 직접 디스크에 데이터를 읽고 쓰는 특수 목적의 소프트웨어가 사용

## 4. 파일 공유와 동시성 제어

- 여러 사용자가 하나의 시스템에 접근하는 환경에서 파일을 안전하게 공유하는 것이 중요하다
### 운영체제 역할
1.  **접근 제어**: 누가 파일을 읽고, 쓰고, 실행할 수 있는지 권한을 관리
    - 사용자, 그룹, 기타(others)에 대해 권한을 다르게 설정하여 파일을 보호
2.  **일관성 유지**: 여러 사용자가 동시에 같은 파일을 수정하려고 할 때 데이터가 꼬이는 것을 막아야 함
    - 이를 위해 운영체제는 **잠금(Locking)** 매커니즘을 사용함
    - 한 사용자가 파일을 수정하는 동안에는 다른 사용자가 수정할 수 없도록 막아 데이터의 일관성을 지킴

## 5. 가상 파일 시스템 (VFS)

- 운영체제가 `NTFS`, `ext4`, `APFS` 등 세상에 존재하는 모든 파일 시스템의 작동 방식을 각각 알 필요는 없다
    - **가상 파일 시스템(Virtual File System, VFS)**: 다양한 파일 시스템 위에서 동작하는 일종의 **추상화 계층**

VFS 덕분에 개발자들은 파일 시스템의 종류와 관계없이 `open()`, `read()`, `write()` 같은 표준 함수를 사용하여 파일에 접근할 수 있음. VFS가 마치 번역가처럼 중간에서 각 파일 시스템에 맞는 명령으로 변환해준다.

## 6. 원격 파일 시스템

- `NFS(Network File System)`나 `SMB(Server Message Block)`
    - 네트워크로 연결된 다른 컴퓨터의 저장 공간을 내 컴퓨터의 일부인 것처럼 사용하게 해주는 기술

- **클라이언트-서버 구조**
    - **서버**: 파일을 공유해주는 쪽
    - **클라이언트**: 파일을 가져다 쓰는 쪽
- 클라이언트가 서버의 특정 폴더를 마운트하면, 사용자는 네트워크 너머에 있는 파일이라는 사실을 거의 인지하지 못한 채 로컬 파일처럼 편리하게 작업할 수 있음.

## 7. 부팅

컴퓨터 전원을 켜면, **부트로더(Bootloader)**라는 작은 프로그램이 먼저 실행됨. 부트로더는 디스크의 특정 파티션에 설치된 파일 시스템을 읽어 **운영체제 커널**을 메모리에 올리는 핵심 역할을 함.

- 운영체제가 담긴 파일 시스템은 부팅이 가능해야 합니다.
- 만약 컴퓨터에 여러 운영체제가 설치되어 있다면, 부팅 과정에서 관리자가 어떤 운영체제로 시작할지 선택할 수 있는 메뉴가 나타나기도 합니다.